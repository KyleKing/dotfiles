# Sourced for interactive shells - https://unix.stackexchange.com/a/487889

# Path to your oh-my-zsh installation.
export ZSH="/Users/kyleking/.oh-my-zsh"
# export ZSH_CUSTOM=$ZSH  # Set in `$ZSH/oh-my-zsh.sh`

# > Look in ~/.oh-my-zsh/themes/
# https://github.com/robbyrussell/oh-my-zsh/wiki/Themes
# https://github.com/robbyrussell/oh-my-zsh/wiki/External-themes
# ZSH_THEME="powerlevel10k/powerlevel10k"
# Others: agnoster, oxide, Bullet train, lambda-mod, Spaceship ZSH, Halil
# > Note: installed with brew and not oh-my-zsh
source $(brew --prefix)/opt/powerlevel10k/powerlevel10k.zsh-theme
# Create a new configuration file `p10k configure` or modify an existing one at ~/.p10k.zsh

# Uncomment the following line to use hyphen-insensitive completion.
# Case-sensitive completion must be off. _ and - will be interchangeable.
HYPHEN_INSENSITIVE="true"

# Uncomment the following line to automatically update without prompting.
# DISABLE_UPDATE_PROMPT="true"

# Uncomment the following line if pasting URLs and other text is messed up.
# DISABLE_MAGIC_FUNCTIONS="true"

# Uncomment the following line to enable command auto-correction.
# ENABLE_CORRECTION="true"

# Uncomment the following line to display red dots whilst waiting for completion.
# Caution: this setting can cause issues with multiline prompts (zsh 5.7.1 and newer seem to work)
# See https://github.com/ohmyzsh/ohmyzsh/issues/5765
COMPLETION_WAITING_DOTS="true"

# Uncomment the following line if you want to disable marking untracked files
# under VCS as dirty. This makes repository status check for large repositories
# much, much faster.
# DISABLE_UNTRACKED_FILES_DIRTY="true"

# Would you like to use another custom folder than $ZSH/custom?
# ZSH_CUSTOM=/path/to/new-custom-folder

# Which plugins would you like to load?
# Standard plugins can be found in $ZSH/plugins/
# Custom plugins may be added to $ZSH_CUSTOM/plugins/
# Example format: plugins=(rails git textmate ruby lighthouse)
# Add wisely, as too many plugins slow down shell startup.
# Which plugins would you like to load? (plugins can be found in ~/.oh-my-zsh/plugins/*)

# Use `omz plugin info <name>` to learn more about each. Prints the README (`omz plugin info zsh-autosuggestions`)
# https://github.com/robbyrussell/oh-my-zsh/wiki/Plugins
# https://github.com/robbyrussell/oh-my-zsh/wiki/Plugins-Overview
plugins=(
#   # autopep8
#   # branch
#   # bundler
#   # cask
#   # catimg
#   # celery
#   # chucknorris
#   # codeclimate
#   # coffee
#   # composer
#   # copybuffer
#   # cpanm
#   # dirpersist
#   # dnf
#   # dnote
#   # docker
#   # doctl
#   # dotenv
#   # droplr
#   # emoji
#   # emoji-clock
#   # emotty
#   # extract
#   # fancy-ctrl-z
#   # fasd
#   # fbterm
#   # fd
#   # firewalld
#   # frontend-search
#   # fzf
#   # gas
#   # gb
#   # git-flow
#   # git-hubflow
#   # git-prompt
#   # git-remote-branch
#   # github
#   # glassfish
#   # globalias
#   # gnu-utils
#   # hanami
#   # history-substring-search
#   # homestead
#   # httpie
#   # kate
#   # keychain
#   # kitchen
#   # knife
#   # last-working-dir - may interfere with VS Code
#   # lighthouse
#   # macports
#   # magic-enter
#   # marked2
#   # mix
#   # mix-fast
#   # mosh
#   # nanoc
#   # ng
#   # node
#   # nomad
#   # npm
#   # npx
#   # nvm
#   # oc
#   # otp
#   # pep
#   # per-directory-history
#   # percol
#   # perms
#   # phing
#   # pip
#   # pj
#   # please
#   # pod
#   # pow
#   # powder
#   # powify
#   # profiles
#   # pyenv
#   # python
#   # rand-quote
#   # react-native
#   # repo
#   # ripgrep
#   # rsync
#   # safe-paste
#   # salt
#   # sbt
#   # scd
#   # screen
#   # scw
#   # sdk
#   # sfdx
#   # sfffe
#   # shrink-path
#   # siftpm
#   # singlechar
#   # spring
#   # sprunge
#   # ssh-agent
#   # stack
#   # supervisor
#   # svcat
#   # symfony2
#   # systemadmin
#   # systemd
#   # taskwarrior
#   # terminitor
#   # terraform
#   # tig
#   # timer
#   # tmux
#   # transfer
#   # tugboat
#   # ubuntu
#   # ufw
#   # urltools
#   # vault
#   # vundle
#   # wakeonlan
#   # web-search
#   # wp-cli
#   # xcode
#   # yarn
#   # yum
#   # zeus
#   # zsh-navigation-tools

#   colored-man-pages
#   colorize
#   command-not-found
#   common-aliases
#   compleat
#   copydir
#   copyfile
#   cp
#   dircycle
#   dirhistory
#   docker
#   encode64
#   git
#   git-auto-fetch
#   git-extras
#   gitfast
#   gitignore
#   jsontools
#   nmap
#   sudo
#   themes

  # man
  # history
  # thefuck
  # wd

  # From Colin
  # lein
  # zsh-nvm

  # # From: https://www.howtogeek.com/362409/what-is-zsh-and-why-should-you-use-it-instead-of-bash/
  # zsh-autosuggestions
  # zsh-syntax-highlighting
  # mouse

  # > lol: alias yolo="git commit -m "$(curl -s http://whatthecommit.com/index.txt)""

  # > homebrew. Use: brewp (pin to prevent upgrade), brewsp (list pinned), bubu (update, upgrade, cleanup), bcubc (cask)
  brew
  # > Kapeli Dash. Use: `dash python:tuple`
  dash
  # > History. Use: h, hs <> (grep), hsi <> (grep -i)
  history
  # > Mac commands. Use: quick-look, man-preview, hidefiles, showfiles, music, rmdsstore, btrestart
  macos
  # > Aliases for VSCode. Use: `vscd file file` (diff)
  vscode
  # PLANNED: Sublime?
  sublime

  # # Git checkouts
  # # # See: https://github.com/zdharma/fast-syntax-highlighting#oh-my-zsh
  # # fast-syntax-highlighting
  # # # See: https://github.com/zsh-users/zsh-completions
  # # zsh-completions

  # https://github.com/zsh-users/zsh-autosuggestions/blob/master/INSTALL.md
  # git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
  zsh-autosuggestions

  # https://github.com/zsh-users/zsh-syntax-highlighting/blob/master/INSTALL.md
  # git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
  # > Must be last!
  zsh-syntax-highlighting
)

# ----------------------------------------------------------------------------------------------------------------------
# Misc. Hacks

# Fix for commit signing on the command line
# See: https://stackoverflow.com/a/42265848/3219667
export GPG_TTY=$(tty)

# ----------------------------------------------------------------------------------------------------------------------
# User configuration

source $ZSH/oh-my-zsh.sh

# export MANPATH="/usr/local/man:$MANPATH"

# You may need to manually set your language environment
# export LANG=en_US.UTF-8

# Preferred editor for local and remote sessions
# if [[ -n $SSH_CONNECTION ]]; then
#   export EDITOR='vim'
# else
#   export EDITOR='nano'
# fi

# Compilation flags
# export ARCHFLAGS="-arch x86_64"

# Set personal aliases, overriding those provided by oh-my-zsh libs,
# plugins, and themes. Aliases can be placed here, though oh-my-zsh
# users are encouraged to define aliases within the ZSH_CUSTOM folder.
# For a full list of active aliases, run `alias`.
# FYI: Global variables are used as aliases for commands that take pipe input
#
# Example aliases
# alias zshconfig="mate ~/.zshrc"
# alias ohmyzsh="mate ~/.oh-my-zsh"

# ----------------------------------------------------------------------------------------------------------------------
# Start User Stuff

# Set an alias for thefuck installed with brew: https://github.com/nvbn/thefuck
eval $(thefuck --alias oop)

# Configuration for zsh-autosuggestions
export ZSH_AUTOSUGGEST_STRATEGY=(match_prev_cmd completion history)
# Keyword shortcuts for different acceptance strategies
# Tab: List of Suggestions for next word. Auto-accepts if only one option
#   Tab (again): to scroll through list
#
# (ctrl space, ctrl shit n, ctrl shift p)
bindkey '^ ' autosuggest-accept
# Base on: https://github.com/zsh-users/zsh-autosuggestions/issues/609#issuecomment-904204583
bindkey "^N" history-beginning-search-forward
bindkey "^P" history-beginning-search-backward

alias ppj="pbaspate | jq"
alias t8="saml2aws -a dev exec -- terraform"
alias copy-l="fc -ln 0 | tail -n 1 | pbcopy"

# ----------------------------------------------------------------------------------------------------------------------
# # Don't put duplicate lines in the history: https://www.eriwen.com/bash/effective-shorthand/
# export HISTCONTROL=ignoredups

# Lines configured by zsh-newuser-install
HISTFILE=~/.histfile
HISTSIZE=1000
SAVEHIST=1000
bindkey -e
# End of lines configured by zsh-newuser-install
# The following lines were added by compinstall
zstyle :compinstall filename '~/.zshrc'

# autoload -Uz compinit
# compinit
# End of lines added by compinstall

# Source homebrew-installed completions
# Explanantion: https://docs.brew.sh/Shell-Completion
if type brew &>/dev/null
then
  FPATH="$(brew --prefix)/share/zsh/site-functions:${FPATH}"

  autoload -Uz compinit
  compinit
fi

# ----------------------------------------------------------------------------------------------------------------------
# Terminal Tool Configurations

# # Source: https://github.com/jesseduffield/lazygit#changing-directory-on-exit
# lzg() {
#     export LAZYGIT_NEW_DIR_FILE=~/.lazygit/newdir

#     lazygit "$@"

#     if [ -f $LAZYGIT_NEW_DIR_FILE ]; then
#             cd "$(cat $LAZYGIT_NEW_DIR_FILE)"
#             rm -f $LAZYGIT_NEW_DIR_FILE > /dev/null
#     fi
# }
alias lzg='lazygit'

# Source: https://github.com/jesseduffield/lazydocker
alias lzd='lazydocker'

# Map exa to ls with some default options
alias ls='exa --icons --all'
alias lsb='ls --long --header --created --git'
alias lst='lsb -TL 2'

# # If file exists, source special file
# [ -f /.is_work ] && source ~/TBD/.workrc

# # https://github.com/junegunn/fzf
# # To install useful key bindings and fuzzy completion:
# # Run once!
# # $(brew --prefix)/opt/fzf/install
# # To uninstall!
# # $(brew --prefix)/opt/fzf/uninstall
# [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
# # cat $(fzf)
# https://github.com/ajeetdsouza/zoxide
# After fzf
eval "$(zoxide init zsh)"
# zoxide query  --list --score
# z foo              # cd into highest ranked directory matching foo
# z foo bar          # cd into highest ranked directory matching foo and bar
#
# z ~/foo            # z also works like a regular cd command
# z foo/             # cd into relative path
# z ..               # cd one level up
# z -                # cd into previous directory
#
# zi foo             # cd with interactive selection (using fzf)
#
# z foo<SPACE><TAB>  # show interactive completions (zoxide v0.7.10+, bash/fish/zsh only)

# TODO: Sync gh and krew plugins
# gh extension list
# kubectl krew list ??
# brew list --versions && brew doctor && brew outdated
# pipx list

export PR_CHECKOUT_DIR=~/developer/checkouts
if [[ -d $PR_CHECKOUT_DIR ]] {
    alias clone-pr() {
        cd $PR_CHECKOUT_DIR && gh repo clone $1 $1/pr$2 && cd $1/pr$2 && gh pr checkout $2 --force
    }
}
# clone-pr timothycrosley/pdocs 25
# clone-pr dash_charts 25

# ----------------------------------------------------------------------------------------------------------------------
# Lines added through additional installs

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# > pipx completions require bashcompinit
# autoload -U bashcompinit
# bashcompinit
eval "$(register-python-argcomplete pipx)"

# FYI: Deactivated iterm2 shell integration because marks keybaord shortcut (up-arrow) conflicted with history
# # Install iTerm Shell Integration from Menu bar
# test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

# One Password CLI session (created with "op signin my.1password.com kmking72@gmail.com")
export OP_SESSION_my="-ukvw1Lu8pdlYU_bAdPWC3L6WbGEJKsyO1nan83PDcg"

# Created by NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

# # ----------------------------------------------------------------------------------------------------------------------
# # Old Paths

# # Add scripts from custom bin/ directory
# export PATH=$PATH:$HOME/bin/

# # NVM Installation
# export NVM_DIR="$HOME/.nvm"
# [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
# [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

# # Add sbin path for Homebrew
# export PATH="/usr/local/sbin:$PATH"

# # >>> conda initialize >>>
# # !! Contents within this block are managed by 'conda init' !!
# __conda_setup="$('/usr/local/Caskroom/miniconda/base/bin/conda' 'shell.zsh' 'hook' 2> /dev/null)"
# if [ $? -eq 0 ]; then
#     eval "$__conda_setup"
# else
#     if [ -f "/usr/local/Caskroom/miniconda/base/etc/profile.d/conda.sh" ]; then
#         . "/usr/local/Caskroom/miniconda/base/etc/profile.d/conda.sh"
#     else
#         export PATH="/usr/local/Caskroom/miniconda/base/bin:$PATH"
#     fi
# fi
# unset __conda_setup
# # <<< conda initialize <<<

# ----------------------------------------------------------------------------------------------------------------------
# export PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"
# export PATH="/usr/local/opt/openjdk/bin:$PATH"
# export JDK_HOME=/Users/kyleking/.sdkman/candidates/java/current/

#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!
export SDKMAN_DIR="$HOME/.sdkman"
[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

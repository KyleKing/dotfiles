---
projects:
  active-learning-pipelines:
    url: git@github.com:roaminsight/active-learning-pipelines.git
    desc: General Roam Project

  ai-labs-diagrams:
    url: git@github.com:roaminsight/ai-labs-diagrams.git
    desc: General Roam Project

  alp-client:
    url: git@github.com:roaminsight/alp-client.git
    desc: General Roam Project

  analysis_notebooks:
    url: git@github.com:roaminsight/analysis_notebooks.git
    desc: General Roam Project

  analysisbox:
    url: git@github.com:roaminsight/analysisbox.git
    desc: General Roam Project

  annotation-db:
    url: git@github.com:roaminsight/annotation-db.git
    desc: Shared RDS Terraform for AM, Boots, Reviewer, etc.

  annotation-manager:
    url: git@github.com:roaminsight/annotation-manager.git
    desc: AM Application

  auth-sidecar:
    url: git@github.com:roaminsight/auth-sidecar.git
    desc: General Roam Project

  authenticator:
    url: git@github.com:roaminsight/authenticator.git
    desc: Legacy Authenticator Application

  authenticator-express:
    url: git@github.com:roaminsight/authenticator-express.git
    desc: Legacy Authenticator Application

  aws-org:
    url: git@github.com:roaminsight/aws-org.git
    desc: General Roam Project

  babylon:
    url: git@github.com:roaminsight/babylon.git
    desc: Backend Pipelines and Moana Replacement

  babylon-notebooks:
    url: git@github.com:roaminsight/babylon-notebooks.git
    desc: General Roam Project

  boots:
    url: git@github.com:roaminsight/boots.git
    desc: Explorer Application

  catnip:
    url: git@github.com:roaminsight/catnip.git
    desc: General Roam Project

  cellar:
    url: git@github.com:roaminsight/cellar.git
    desc: Split from Babylon

  client-onboarding:
    url: git@github.com:roaminsight/client-onboarding.git
    desc: General Roam Project

  cloudwatch-log-collector:
    url: git@github.com:roaminsight/cloudwatch-log-collector.git
    desc: General Roam Project

  config-express:
    url: git@github.com:roaminsight/config-express.git
    desc: General Roam Project

  config-service:
    url: git@github.com:roaminsight/config-service.git
    desc: Overengineered links between applications

  corporate-productivity:
    url: git@github.com:roaminsight/corporate-productivity.git
    desc: General Roam Project

  csa:
    url: git@github.com:roaminsight/csa.git
    desc: General Roam Project

  ccioms-summarization:
    url: git@github.com:roaminsight/ccioms-summarization.git
    desc: General Roam Project

  data-classification:
    url: git@github.com:roaminsight/data-classification.git
    desc: General Roam Project

  data-converter:
    url: git@github.com:roaminsight/data-converter.git
    desc: General Roam Project

  dougs-private-pocs:
    url: git@github.com:roaminsight/dougs-private-pocs.git
    desc: General Roam Project

  drugparse:
    url: git@github.com:roaminsight/drugparse.git
    desc: General Roam Project

  ecr-repos:
    url: git@github.com:roaminsight/ecr-repos.git
    desc: General Roam Project

  email-task:
    url: git@github.com:roaminsight/email-task.git
    desc: General Roam Project

  email-utils:
    url: git@github.com:roaminsight/email-utils.git
    desc: General Roam Project

  e2b-service:
    url: git@github.com:roaminsight/e2b-service.git
    desc: General Roam Project

  gists:
    url: git@github.com:roaminsight/gists.git
    desc: General Roam Project

  github-actions:
    url: git@github.com:roaminsight/github-actions.git
    desc: General Roam Project

  github-config:
    url: git@github.com:roaminsight/github-config.git
    desc: General Roam Project

  graft:
    url: git@github.com:roaminsight/graft.git
    desc: General Roam Project

  home-tests:
    url: git@github.com:roaminsight/home-tests.git
    desc: General Roam Project

  icsr-research-project:
    url: git@github.com:roaminsight/icsr-research-project.git
    desc: General Roam Project

  import-parser:
    url: git@github.com:roaminsight/import-parser.git
    desc: Email Parser Backend for Reviewer

  intern-projects:
    url: git@github.com:roaminsight/intern-projects.git
    desc: General Roam Project

  janus:
    url: git@github.com:roaminsight/janus.git
    desc: General Roam Project

  jupyter-react-widgets:
    url: git@github.com:roaminsight/jupyter-react-widgets.git
    desc: General Roam Project

  k8s-gitops:
    url: git@github.com:roaminsight/k8s-gitops.git
    desc: General Roam Project

  knowledge-service:
    url: git@github.com:roaminsight/knowledge-service.git
    desc: General Roam Project

  kubewatch:
    url: git@github.com:roaminsight/kubewatch.git
    desc: General Roam Project

  logging-utils:
    url: git@github.com:roaminsight/logging-utils.git
    desc: General Roam Project

  microsoft-word-add-in:
    url: git@github.com:roaminsight/microsoft-word-add-in.git
    desc: General Roam Project

  mittens:
    url: git@github.com:roaminsight/mittens.git
    desc: General Roam Project

  mobius-notebooks:
    url: git@github.com:roaminsight/mobius-notebooks.git
    desc: General Roam Project

  mobiuscore:
    url: git@github.com:roaminsight/mobiuscore.git
    desc: General Roam Project

  model-utils:
    url: git@github.com:roaminsight/model-utils.git
    desc: General Roam Project

  mvrs:
    url: git@github.com:roaminsight/mvrs.git
    desc: General Roam Project

  object-permissions:
    url: git@github.com:roaminsight/object-permissions.git
    desc: General Roam Project

  ocr-pipelines:
    url: git@github.com:roaminsight/ocr-pipelines.git
    desc: General Roam Project

  okta-ldap-sync:
    url: git@github.com:roaminsight/okta-ldap-sync.git
    desc: General Roam Project

  opsbot:
    url: git@github.com:roaminsight/opsbot.git
    desc: General Roam Project

  parexel-chat:
    url: git@github.com:roaminsight/parexel-chat.git
    desc: General Roam Project

  parexel-chat-nlp:
    url: git@github.com:roaminsight/parexel-chat-nlp.git
    desc: General Roam Project

  parexel-chat-services:
    url: git@github.com:roaminsight/parexel-chat-services.git
    desc: General Roam Project

  pdfcore:
    url: git@github.com:roaminsight/pdfcore.git
    desc: Low-Level PDF Tooling

  permission:
    url: git@github.com:roaminsight/permission.git
    desc: General Roam Project

  redux-kit:
    url: git@github.com:roaminsight/redux-kit.git
    desc: General Roam Project

  repository:
    url: git@github.com:roaminsight/repository.git
    desc: General Roam Project
    tags:
      - Archived

  repository-template:
    url: git@github.com:roaminsight/repository-template.git
    desc: General Roam Project

  reviewer:
    url: git@github.com:roaminsight/reviewer.git
    desc: Reviewer

  risk-tools:
    url: git@github.com:roaminsight/risk-tools.git
    desc: General Roam Project

  roam-confluence:
    url: git@github.com:roaminsight/roam-confluence.git
    desc: Self-hosted Confluence Instance

  roam-engage:
    url: git@github.com:roaminsight/roam-engage.git
    desc: General Roam Project

  roam-expectedness:
    url: git@github.com:roaminsight/roam-expectedness.git
    desc: General Roam Project

  roam-hound:
    url: git@github.com:roaminsight/roam-hound.git
    desc: General Roam Project

  roam-infra:
    url: git@github.com:roaminsight/roam-infra.git
    desc: General Roam Project

  roam-jenkins:
    url: git@github.com:roaminsight/roam-jenkins.git
    desc: Self-hosted Jenkins instance

  roam-jira:
    url: git@github.com:roaminsight/roam-jira.git
    desc: Self-hosted JIRA Instance

  roam-k8s:
    url: git@github.com:roaminsight/roam-k8s.git
    desc: General Roam Project

  roam-knowledge-base:
    url: git@github.com:roaminsight/roam-knowledge-base.git
    desc: General Roam Project

  roam-nexus:
    url: git@github.com:roaminsight/roam-nexus.git
    desc: General Roam Project

  roam-packer:
    url: git@github.com:roaminsight/roam-packer.git
    desc: General Roam Project

  roam-topics:
    url: git@github.com:roaminsight/roam-topics.git
    desc: General Roam Project

  roam-utils:
    url: git@github.com:roaminsight/roam-utils.git
    desc: General Roam Project

  roamkg:
    url: git@github.com:roaminsight/roamkg.git
    desc: General Roam Project

  sanitize-html:
    url: git@github.com:roaminsight/sanitize-html.git
    desc: General Roam Project

  sas-extension-poc:
    url: git@github.com:roaminsight/sas-extension-poc.git
    desc: General Roam Project

  semantic-search:
    url: git@github.com:roaminsight/semantic-search.git
    desc: General Roam Project

  serve:
    url: git@github.com:roaminsight/serve.git
    desc: General Roam Project

  serve-client:
    url: git@github.com:roaminsight/serve-client.git
    desc: General Roam Project

  shared-dotfiles:
    url: git@github.com:roaminsight/shared-dotfiles.git
    desc: General Roam Project

  solve-pv:
    url: git@github.com:roaminsight/solve-pv.git
    desc: General Roam Project

  spandoc:
    url: git@github.com:roaminsight/spandoc.git
    desc: General Roam Project

  spellcheck:
    url: git@github.com:roaminsight/spellcheck.git
    desc: General Roam Project

  spinnaker:
    url: git@github.com:roaminsight/spinnaker.git
    desc: General Roam Project

  stage-replication:
    url: git@github.com:roaminsight/stage-replication.git
    desc: General Roam Project

  stap:
    url: git@github.com:roaminsight/stap.git
    desc: General Roam Project

  sumo-logic:
    url: git@github.com:roaminsight/sumo-logic.git
    desc: General Roam Project

  surge:
    url: git@github.com:roaminsight/surge.git
    desc: General Roam Project

  template-ui-app:
    url: git@github.com:roaminsight/template-ui-app.git
    desc: General Roam Project

  terraform-modules:
    url: git@github.com:roaminsight/terraform-modules.git
    desc: General Roam Project

  test-utils:
    url: git@github.com:roaminsight/test-utils.git
    desc: General Roam Project

  textract-cli:
    url: git@github.com:roaminsight/textract-cli.git
    desc: General Roam Project

  transfer:
    url: git@github.com:roaminsight/transfer.git
    desc: General Roam Project

  ui-core:
    url: git@github.com:roaminsight/ui-core.git
    desc: General Roam Project

  zathras:
    url: git@github.com:roaminsight/zathras.git
    desc: Split from Babylon

tasks:
  remove-force-pushed-tags:
    desc: See https://github.com/roaminsight/github-actions/pull/121
    cmd: |
      git pull --tags
      for env in dev stage prod; do
          # git push --delete origin tags/$env
          git tag --list --sort=-creatordate "$env-*" | xargs -I{} git push --delete origin "{}"
      done
      git fetch --prune --prune-tags

  sync-tags:
    desc: Sync deployment tags
    cmd: git sync-tags

  git-status:
    desc: show working tree status
    output: table
    parallel: true
    cmd: git status

  git-pull:
    desc: pull remote updates. Exit 0 on error
    cmd: git pull || true

  gpoi:
    desc: run GH poi to remove closed branches
    cmd: |
      COUNT=$(git branch --format='%(HEAD) %(refname:short) -> %(upstream:short)' | wc -l)
      if (("$COUNT" > 1)); then gh poi; else echo "No branches are checked out"; fi
      git pull

  git-prune:
    desc: remove local branches and tags which have been deleted on remote
    env:
      remote: origin
    cmd: git fetch --prune --prune-tags

  git-stashes:
    desc: list all git stashes
    env:
      remote: origin
    cmd: git stash list

  migrate-poetry:
    desc: Migrate deprecated poetry 'default=true' source to 'priority=default'
    cmd: |
      # Poetry Source Docs: https://python-poetry.org/docs/cli#source
      FOUND=$(fd pyproject.toml)
      if [[ -z "$FOUND" ]]; then
          echo "No pyproject.toml found"
          exit 0
      fi

      OrigWD=$PWD
      for pth_pyproject in $(echo $FOUND); do
          echo "Editing '$pth_pyproject'"
          cd "${pth_pyproject%/*}"
          sed -I '' "s/default = true/priority = \"default\"/" pyproject.toml
          toml-sort pyproject.toml  --in-place --all --trailing-comma-inline-array --sort-first=python
          poetry lock --no-update
          cd "$OrigWD"
      done

      TITLE="[PPLMS-2723] Migrate to pyproject.toml source to 'priority'"
      git branch PPLMS-2723-MigrateSourePriority
      git checkout PPLMS-2723-MigrateSourePriority
      git push -u origin "$(git rev-parse --abbrev-ref HEAD)"
      git add .
      git commit --message="$TITLE"
      gh pr create --reviewer="atayardimci" --assignee="@me" --title="$TITLE" --web

  git-daily:
    desc: show branch, local and remote diffs, last commit and date
    commands:
      - name: branch
        cmd: git rev-parse --abbrev-ref HEAD

      - name: status
        cmd: git status

      - name: local diff
        cmd: git diff --name-only | wc -l

      - name: remote diff
        cmd: |
          current_branch=$(git rev-parse --abbrev-ref HEAD)
          git diff "$current_branch" "origin/$current_branch" --name-only 2> /dev/null | wc -l

      - name: last commit
        cmd: git log -1 --pretty=%B

      - name: commit date
        cmd: git log -1 --format="%cd (%cr)" -n 1 --date=format:"%d  %b %y" | sed 's/ //'
